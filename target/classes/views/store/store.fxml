<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.cell.PropertyValueFactory?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Priority?>
<?import javafx.scene.layout.VBox?>

<BorderPane xmlns="http://javafx.com/javafx/21.0.1"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="controllers.StoreController">

    <top>
        <HBox spacing="20" style="-fx-padding: 15; -fx-background-color: #212529;">
            <Label fx:id="welcomeLabel"
                   style="-fx-text-fill: white; -fx-font-size: 18; -fx-font-weight: bold;"/>
            <Label fx:id="balanceLabel" style="-fx-text-fill: #ffd43b; -fx-font-size: 16;"/>
            <HBox HBox.hgrow="ALWAYS"/>
            <Button text="Se dÃ©connecter" onAction="#handleLogout"
                    style="-fx-background-color: transparent; -fx-border-color: #fff; -fx-text-fill: #fff;"/>
        </HBox>
    </top>

    <center>
        <VBox spacing="12" style="-fx-padding: 20; -fx-background-color: rgba(255,255,255,0.8);">
            <Label text="Billets disponibles ðŸŽŸï¸" style="-fx-font-size: 20; -fx-font-weight: bold; -fx-text-fill: #1f2d3d;"/>
            <HBox spacing="8" alignment="CENTER_LEFT">
                <Label text="Recharger mon solde" style="-fx-font-weight: bold;"/>
                <TextField fx:id="rechargeField" promptText="Montant â‚¬" prefWidth="100"/>
                <Button text="Ajouter" onAction="#handleAddFunds"
                        style="-fx-background-color: linear-gradient(to right, #51cf66, #2b8a3e); -fx-text-fill: white;"/>
                <Label fx:id="rechargeFeedback" style="-fx-text-fill: #2b8a3e;"/>
            </HBox>
            <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED"
                        style="-fx-background-color: transparent; -fx-padding: 4;">
                <content>
                    <FlowPane fx:id="eventGrid" hgap="16" vgap="16"
                              prefWrapLength="900"
                              style="-fx-padding: 4;"/>
                </content>
            </ScrollPane>
            <HBox spacing="10" alignment="CENTER_RIGHT">
                <Label fx:id="feedbackLabel" style="-fx-text-fill: #495057;" HBox.hgrow="ALWAYS"/>
                <Button text="Acheter ce billet" onAction="#handleBuyTicket"
                        style="-fx-background-color: #2f9e44; -fx-text-fill: white;"/>
            </HBox>
        </VBox>
    </center>

    <right>
        <VBox spacing="10" style="-fx-padding: 20; -fx-background-color: #f8f9fa;" prefWidth="320">
            <Label text="Mes billets ðŸŽ«" style="-fx-font-weight: bold;"/>
            <TableView fx:id="purchaseTable">
                <columns>
                    <TableColumn fx:id="purchaseEventColumn" text="Ã‰vÃ©nement" prefWidth="160"/>
                    <TableColumn fx:id="purchasePriceColumn" text="Prix" prefWidth="80"/>
                    <TableColumn fx:id="purchaseDateColumn" text="Date" prefWidth="140"/>
                </columns>
            </TableView>
            <Button text="Afficher le QR du billet sÃ©lectionnÃ©" onAction="#handleShowTicketQr"
                    style="-fx-background-color: #364fc7; -fx-text-fill: white; -fx-background-radius: 8;"/>
            <Label text="Astuce : double-clique un achat pour voir le QR." style="-fx-text-fill: #6c757d;"/>
        </VBox>
    </right>

</BorderPane>
